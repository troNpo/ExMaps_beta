<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ExMaps</title>
  
  <!-- Estilos -->
  <link rel="stylesheet" href="style.css" />

  <!-- Leaflet para mapas -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-gpx/1.5.1/gpx.min.js"></script>
  <!-- Geocoder plugin para Nominatim -->
<link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />
<script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
</head>
<body>
    
    <!-- bot√≥n men√∫ flotante -->
        <button id="toggleBotonera" class="toggle-botonera" title="Mostrar/Ocultar barra">
  <img src="icons/ui/fi-sr-brain-circuit.svg" alt="Toggle" />
</button>
    
    <!-- botonera lateral  -->
  <div id="barraControles" class="barra-lateral">
  <!-- üìç Buscar lugar (Nominatim) -->
  <div class="bloque-boton">
    <button id="btnBuscarLugar" title="Buscar lugar" class="btnLateral">
      <img src="icons/ui/fi-sr-land-location.svg" alt="Buscar lugar" />
    </button>
    <span>Ubicaci√≥n</span>
  </div>
  <!-- capas -->
<div class="bloque-boton">
  <button id="btnPanelCapas" class="btnLateral" title="Capas del mapa">
    <img src="icons/ui/fi-sr-layers.svg" alt="Capas">
  </button>
  <span>Capas</span>
</div>

  <!-- ‚ûï Zoom in  -->
  <div class="bloque-boton">
    <button id="btnZoomIn" title="Acercar mapa" class="btnLateral">
      <img src="icons/ui/fi-sr-zoom-in.svg" alt="Zoom +" />
    </button>
     <span>zoom</span>
  </div>
 

  <!-- ‚ûñ Zoom out  -->
  <div class="bloque-boton">
    <button id="btnZoomOut" title="Alejar mapa" class="btnLateral">
      <img src="icons/ui/fi-sr-zoom-out.svg" alt="Zoom -" />
    </button>
  </div>

  <!-- üçî Categor√≠as -->
  <div class="bloque-boton">
    <button id="menuBtn" title="Abrir panel" class="btnLateral">
      <img src="icons/ui/fi-sr-category.svg" alt="Men√∫" />
    </button>
    <span>Categor√≠as</span>
  </div>

  
  <!-- üîÑ Actualizar b√∫squeda -->
  <div class="bloque-boton">
    <button id="btnBusquedaDirecta" title="Buscar desde mapa" class="btnLateral">
      <img src="icons/ui/fi-sr-search.svg" alt="Buscar desde mapa" />
    </button>
    <span>Actualizar</span>
  </div>
  
  <!--  Bot√≥n Limpiar mapa -->
<div class="bloque-boton">
  <button title="Limpiar mapa" class="btnLateral" onclick="limpiarMapa()">
    <img src="icons/ui/fi-sr-eraser.svg" alt="Limpiar mapa" />
  </button>
  <span>Limpiar</span>
</div>

<!-- ajustes  -->
<div class="bloque-boton">
  <button id="btnAjustesMapa" title="Ajustes del mapa" class="btnLateral">
    <img src="icons/ui/fi-sr-square-ellipsis.svg" alt="Ajustes" />
  </button>
  <span>Opciones</span>
</div>
<!-- ‚ùî Bot√≥n de ayuda -->
<div class="bloque-boton">
  <button title="Abrir ayuda en el navegador" class="btnLateral" onclick="window.open('https://tronpoonpo.blogspot.com/p/exmaps-pwa.html', '_blank')">
    <img src="icons/ui/fi-sr-question-square.svg" alt="Ayuda sobre la app" />
  </button>
  <span>Ayuda</span>

</div>
  </div>


<!-- Men√∫ emergente que se abre al pulsar el bot√≥n de ajustes -->
<div id="menuAjustes" class="menu-emergente">

  <button class="cerrarMenu" onclick="cerrarAjustes()">
    <img src="icons/ui/fi-sr-cross-small.svg" alt="Cerrar ajustes" />
  </button>

  <!-- Secci√≥n de usuario -->
  <button onclick="abrirPerfilUsuario()" class="btn-opcion">
    <img src="icons/ui/fi-sr-user-gear.svg" alt="Perfil de usuario" />
    Perfil de usuario
  </button>

<!-- Bot√≥n Exportar -->
<button id="btnExportar" class="btn-opcion">
  <img src="icons/ui/fi-sr-folder-download.svg" alt="Exportar" />
  Exportar
</button>

<!-- Bloque desplegable -->
<div id="bloqueExportar" class="bloque oculto">
  <button onclick="exportarMapaKML(construirPoisPorCategoria())">
    <img src="icons/ui/fi-sr-folder-download.svg" alt="Exportar mapa KML" />
    <span>Exportar todos los POIs del mapa</span>
  </button>

  <button onclick="exportarPOIsSeleccionados()">
    <img src="icons/ui/fi-sr-file-download.svg" alt="Exportar seleccionados KML" />
    <span>Exportar capa personalizada</span>
  </button>
</div>

  <!-- Subir ruta GPX -->
  <button onclick="document.getElementById('bloqueSubidaGPX').classList.toggle('visible')" class="btn-opcion">
    <img src="icons/ui/fi-sr-upload.svg" alt="Subir GPX" />
    Subir ruta GPX
  </button>

  <div id="bloqueSubidaGPX" class="bloque-config oculto">
    <label for="inputGPX">Selecciona archivo GPX:</label>
    <input type="file" id="inputGPX" accept=".gpx" />
  </div>
  <button onclick="borrarRutaGPX()" class="btn-opcion">
  <img src="icons/ui/fi-sr-trash.svg" alt="Borrar GPX" />
  Borrar ruta GPX
</button>

<!-- üìë Men√∫ compartir ubicaci√≥n del centro del mapa -->
<button onclick="document.getElementById('bloqueCompartir').classList.toggle('visible')" class="btn-opcion">
  <img src="icons/ui/fi-sr-share.svg" alt="Compartir" />
  Compartir ubicaci√≥n centro del mapa
</button>

<div id="bloqueCompartir" class="bloque-config oculto">
  <button onclick="compartirTextoCentroMapa()">
    <img src="icons/ui/fi-sr-blog-text.svg" alt="Texto POI" />
    <span>Compartir como texto</span>
  </button>

  <button onclick="compartirPosicionCentroMapa()">
    <img src="icons/ui/fi-sr-map-marker.svg" alt="Ubicaci√≥n POI" />
    <span>Compartir posici√≥n en otra app</span>
  </button>

  <button onclick="abrirEditorOSMDesdeCentro()">
    <img src="icons/ui/fi-sr-code-editing.svg" alt="Editor OSM" />
    <span>Editar directamente en OpenStreetMap</span>
  </button>

  <button onclick="a√±adirNotaOSMDesdeCentro()">
    <img src="icons/ui/fi-sr-blog-pencil.svg" alt="A√±adir nota OSM" />
    <span>A√±adir sugerencia como nota p√∫blica</span>
  </button>

  <button onclick="abrirVisorWebDesdeCentro('streetview')">
    <img src="icons/ui/fi-sr-street-view.svg" alt="Street View" />
    <span>Ver en Street View</span>
  </button>

  <button onclick="abrirVisorWebDesdeCentro('mapillary')">
    <img src="icons/ui/fi-sr-camera-viewfinder.svg" alt="Mapillary" />
    <span>Ver en Mapillary</span>
  </button>

  <button onclick="abrirVisorWebDesdeCentro('peakfinder')">
    <img src="icons/ui/fi-sr-mountains.svg" alt="PeakFinder" />
    <span>Ver en PeakFinder</span>
  </button>
</div>

  <!-- Configuraci√≥n avanzada -->
  <button onclick="abrirConfiguracionAvanzada()" class="btn-opcion">
    <img src="icons/ui/fi-sr-settings.svg" alt="Configuraci√≥n avanzada" />
    Elementos visuales 
  </button>
</div>


<!-- üìç Panel b√∫squeda Nominatim -->
<div id="panelResultadosNominatim" class="menu-emergente">

  <!-- ‚ùå Bot√≥n cerrar -->
  <button class="btnVolverPanel" onclick="cerrarPanelResultados()">
    <img src="icons/ui/fi-sr-cross-small.svg" alt="Cerrar panel" />
  </button>

  <!-- üß≠ T√≠tulo de b√∫squeda -->
  <label>
    <img src="icons/ui/fi-sr-land-location.svg" alt="Icono ubicaci√≥n" />
    Buscar ubicaci√≥n
  </label>

  <!-- üîç Barra de b√∫squeda por direcci√≥n -->
  <div class="busqueda-wrap">
    <input type="text" id="inputDireccion" placeholder="üìç Escribe una direcci√≥n..." />
    <button id="btnBuscarDireccion">Buscar</button>
  </div>

  <!-- üîó Campo para enlaces geo o Google Maps -->
  <div class="bloque-enlace">
    <label for="inputEnlaceGeo">
      <img src="icons/ui/fi-sr-link-alt.svg" alt="Icono enlace" />
      Enlace de ubicaci√≥n / coordenadas directas 
    </label>
    <input type="text" id="inputEnlaceGeo" placeholder="Pega un enlace geo: o Google Maps" />
    <button id="btnProcesarEnlaceGeo">Procesar enlace</button>
  </div>
<!-- üì° Seguimiento GPS -->
<div class="bloque-switch">
  <label for="switchGPS">
    <img src="icons/ui/fi-sr-location-crosshairs.svg" alt="Icono GPS" />
    Activar seguimiento GPS
  <label class="switch">
  <input type="checkbox" id="switchGPS" onchange="toggleSeguimientoGPSDesdeSwitch(this)">
  <span class="slider"></span>
</label>
</div>

<!-- üß≠ Avisos tipo toast -->
<div id="toastAviso" class="toast oculto"></div>

  <!-- üìã T√≠tulo de resultados -->
  <label>
    <img src="icons/ui/fi-sr-list.svg" alt="Icono lista" />
    Resultados
  </label>

  <!-- üìç √Årea de resultados -->
  <div id="resultadosNominatim"></div>

</div>
<!-- Panel flotante para el perfil de usuario -->
<div id="menuPerfilUsuario" class="menu-emergente">
  <button class="btnVolverPanel cerrarMenu" onclick="cerrarPerfilUsuario()">
    <img src="icons/ui/fi-sr-cross-small.svg" alt="Cerrar panel" />
  </button>

  <h3>Preferencias</h3>

  <!-- üåç Ubicaci√≥n por defecto -->
  <div class="bloque-config">
    <label for="ubicacionDefecto">
      <img src="icons/ui/fi-sr-home-location-alt.svg" alt="Ubicaci√≥n" />
      Ubicaci√≥n por defecto
    </label>
    <input type="text" id="ubicacionDefecto" placeholder="Ej. Sevilla, Espa√±a" />
    <small id="ubicacionConfirmada"></small>

    <!-- üß≠ Nueva opci√≥n: usar √∫ltima ubicaci√≥n -->
   <div class="opcion-switch">
  <label class="switch-label" for="usarUltimaUbicacion">
    Usar √∫ltima ubicaci√≥n mostrada 
    <input type="checkbox" id="usarUltimaUbicacion" />
    <span class="switch-slider"></span>
  </label>
</div>
  </div>

  <!-- üñºÔ∏è Modo de uso -->
  <div class="bloque-config">
    <label for="modoUso">
      <img src="icons/ui/fi-sr-mobile-hand.svg" alt="Modo de uso" />
      Modo de uso
    </label>
    <select id="modoUso">
      <option value="diestro">Diestro</option>
      <option value="zurdo">Zurdo</option>
    </select>
  </div>

  <!-- üó∫Ô∏è Mapa por defecto -->
  <div class="bloque-config">
    <label for="mapaDefecto">
      <img src="icons/ui/fi-sr-map.svg" alt="Mapa por defecto" />
      Mapa por defecto
    </label>
    <select id="mapaDefecto">
      <option value="ultimo">Mantener √∫ltimo mapa usado</option>
      <option value="satellite">Sat√©lite</option>
      <option value="callejero">Callejero</option>
      <option value="topografico">Topogr√°fico</option>
    </select>
  </div>

  <!-- ‚úÖ Bot√≥n guardar -->
  <button onclick="guardarPreferenciasUsuario()" class="btnGuardarPreferencias">
    ‚úÖ Guardar preferencias
  </button>
</div>
<!-- üîß Panel de Configuraci√≥n Avanzada -->
<div id="panelBusquedaAvanzada" class="menu-emergente hidden">
  <!-- Bot√≥n cerrar -->
  <button class="btnVolverPanel cerrarMenu" onclick="cerrarConfiguracionAvanzada()">
    <img src="icons/ui/fi-sr-cross-small.svg" alt="Cerrar panel" />
  </button>

  <h3>Elementos visuales</h3>

 
  <!-- üéØ Mostrar icono central del mapa -->
<div class="opcion-switch">
  <label class="switch-label">
    Mostrar icono central
    <input type="checkbox" id="mostrarIconoCentro">
    <span class="switch-slider"></span>
  </label>
</div>
<!-- üìê Tama√±o del icono central -->
<label for="sliderTamanoIconoCentro">
  <img src="icons/ui/cur_cen.svg" alt="Centro" />
  Tama√±o del icono: <span id="valorTamanoIcono">32</span> px
</label>
<input type="range" id="sliderTamanoIconoCentro" min="16" max="64" step="2" value="32" />

  <!-- üíæ Bot√≥n guardar -->
  <button onclick="guardarConfiguracionBusqueda()" class="btnGuardarPreferencias">
    üíæ Guardar configuraci√≥n
  </button>
</div>

<div id="toastConfirmacion" class="toast">‚úÖ Configuraci√≥n guardada y centro actualizado</div>

  <!-- üìÇ Panel lateral -->
  <div id="sidebar" class="sidebar hidden">
    <div id="logoExMaps">
  <img src="icons/logo512.png" alt="Logo ExMaps" />
</div>  
    <!-- üè∑Ô∏è T√≠tulo de la app -->
    <div id="nombreApp">Puntos de Inter√©s</div> 
   
        <!-- üß≠ Panel principal de selecci√≥n de categor√≠as -->
<div id="panelCategorias" class="subpanel visible">

  <!-- Bot√≥n volver -->
  <button class="btnVolverPanel soloIcono" onclick="cerrarPanelCategorias()">
    <img src="icons/ui/fi-sr-arrow-small-left.svg" alt="Cerrar panel">
  </button>
  <h2>Explorar categor√≠as</h2>
<div id="buscadorPOI">
  <div class="input-wrapper">
    <span class="icon">üîç</span>
    <input type="text" id="inputBusquedaPOI" placeholder="Buscar POI..." />
    <div id="sugerenciasBusqueda"></div>
  </div>
 <div class="accionesCompactas">
  <button id="btnBuscarSeleccionados" class="btnIcono btnRojo">
    <img src="icons/ui/fi-sr-search.svg" alt="Buscar">
    <span>Buscar</span>
  </button>
  <button id="btnLimpiarSeleccion" class="btnIcono">
    <img src="icons/ui/fi-sr-eraser.svg" alt="Limpiar">
    <span>Limpiar</span>
  </button>
</div>
  <button id="btnToggleConfigBusqueda" class="btnSecundario">
  ‚öôÔ∏è Configurar de b√∫squeda
</button>
<div id="bloqueConfigBusqueda" class="bloque-config oculto">
  <label for="sliderRadioBusqueda">
    Radio de b√∫squeda: <span id="valorRadio">1000</span> metros
  </label>
  <input type="range" id="sliderRadioBusqueda" min="100" max="10000" step="100" value="5000" />

  <div class="opcion-switch">
    <label class="switch-label">
      Mantener resultados anteriores
      <input type="checkbox" id="mantenerResultados">
      <span class="switch-slider"></span>
    </label>
  </div>

  <div class="opcion-switch">
    <label class="switch-label">
      B√∫squeda din√°mica al mover el mapa
      <input type="checkbox" id="busquedaDinamica">
      <span class="switch-slider"></span>
    </label>
  </div>

  <button onclick="guardarConfiguracionBusqueda()" class="btnGuardarPreferencias">
    üíæ Guardar configuraci√≥n
  </button>
</div>
<!-- ‚úÖ Bot√≥n para mostrar filtros activos -->
<button id="btnToggleFiltrosActivos" class="btnSecundario oculto">
  üß≠ Mostrar filtros activos
</button>

<!-- ‚úÖ Bloque de filtros activos -->
<div id="filtrosActivos" class="bloque-filtros oculto">
  <h4>üß≠ Filtros activos:</h4>
  <ul id="listaFiltros"></ul>
</div>

</div>

  <!-- Categor√≠as -->
  <div class="grupo-categorias">
    <button onclick="mostrarCategoria('alojamiento')">
      <img src="icons/ui/fi-sr-bed.svg" alt="Alojamiento">
      <span>Alojamiento</span>
    </button>

    <button onclick="mostrarCategoria('comodidades')">
      <img src="icons/ui/fi-sr-faucet.svg" alt="Comodidades">
      <span>Comodidades</span>
    </button>

    <button onclick="mostrarCategoria('emergencias')">
      <img src="icons/ui/fi-sr-hospital.svg" alt="Emergencias">
      <span>Emergencias</span>
    </button>

    <button onclick="mostrarCategoria('naturaleza')">
      <img src="icons/ui/fi-sr-mountain.svg" alt="Naturaleza">
      <span>Naturaleza</span>
    </button>

    <button onclick="mostrarCategoria('ocio_turismo')">
      <img src="icons/ui/fi-sr-castle.svg" alt="Ocio y turismo">
      <span>Ocio y turismo</span>
    </button>

    <button onclick="mostrarCategoria('servicios')">
      <img src="icons/ui/fi-sr-tools.svg" alt="Servicios">
      <span>Servicios</span>
    </button>

    <button onclick="mostrarCategoria('transporte')">
      <img src="icons/ui/fi-sr-plane-alt.svg" alt="Transporte">
      <span>Transporte</span>
    </button>
    
  <button onclick="mostrarCategoria('ciclismo_senderismo')">
    <img src="icons/ui/fi-sr-route.svg" alt="Ciclismo y senderismo">
    <span>Ciclismo y senderismo</span>
  </button>

  </div>
 
</div>

<div id="panelalojamiento" class="subpanel hidden">
  <button class="btnVolverPanel soloIcono" onclick="volverCategorias()">
    <img src="icons/ui/fi-sr-arrow-small-left.svg" alt="Volver">
  </button>
<h2>
  <img src="icons/ui/fi-sr-bed.svg" alt="Alojamiento" class="icono-panel">
  Alojamiento
</h2>
   <!-- Bot√≥n buscar POIs con icono SVG -->
  <button class="btnBuscarPanel" id="btnBuscarAlojamiento">
    <img src="icons/ui/fi-sr-search.svg" alt="Buscar POIs">
    <span>Buscar POIs</span>
  </button>
  <div class="contenedorFiltros">
  <label>
    <input type="checkbox" class="poicheck" data-cat="tourism" data-sub="apartment">
    Apartamento tur√≠stico
  </label>
  <label>
    <input type="checkbox" class="poicheck" data-cat="tourism" data-sub="hostel">
    Albergue / Hostel
  </label>
  <label>
    <input type="checkbox" class="poicheck" data-cat="tourism" data-sub="camp_site">
    Camping
  </label>
  <label>
    <input type="checkbox" class="poicheck" data-cat="tourism" data-sub="caravan_site">
    Caravanas
  </label>
  <label>
    <input type="checkbox" class="poicheck" data-cat="tourism" data-sub="chalet">
    Chalet
  </label>
  <label>
    <input type="checkbox" class="poicheck" data-cat="tourism" data-sub="guest_house">
    Casa de hu√©spedes
  </label>
  <label>
    <input type="checkbox" class="poicheck" data-cat="tourism" data-sub="hotel">
    Hotel
  </label>
  <label>
    <input type="checkbox" class="poicheck" data-cat="tourism" data-sub="motel">
    Motel
  </label>
  <label>
    <input type="checkbox" class="poicheck" data-cat="tourism" data-sub="wilderness_hut">
    Refugio b√°sico
  </label>
  <label>
    <input type="checkbox" class="poicheck" data-cat="tourism" data-sub="alpine_hut">
    Refugio de monta√±a
  </label>
</div>
</div>
  <div id="panelciclismo_senderismo" class="subpanel hidden">
  <!-- üîô Bot√≥n volver -->
  <button class="btnVolverPanel soloIcono" onclick="volverCategorias()">
    <img src="icons/ui/fi-sr-arrow-small-left.svg" alt="Volver" />
  </button>

  <!-- üè∑Ô∏è T√≠tulo con icono -->
  <h2>
    <img src="icons/ui/fi-sr-route.svg" alt="Ciclismo y Senderismo" class="icono-panel" />
    Ciclismo y Senderismo
  </h2>

  <!-- üîç Bot√≥n buscar POIs -->
  <button class="btnBuscarPanel" id="btnBuscarCiclismoSenderismo">
    <img src="icons/ui/fi-sr-search.svg" alt="Buscar POIs" />
    <span>Buscar POIs</span>
  </button>

  <!-- ‚úÖ Filtros agrupados y organizados -->
  <div class="contenedorFiltros">

    <!-- üß≠ Se√±alizaci√≥n -->
    <label><input type="checkbox" class="poicheck" data-cat="information" data-sub="guidepost"> Poste de ruta</label>
    <label><input type="checkbox" class="poicheck" data-cat="information" data-sub="board"> Panel informativo</label>
    <label><input type="checkbox" class="poicheck" data-cat="information" data-sub="terminal"> Terminal digital</label>
    <!-- üö≤ Servicios para ciclistas -->
         <label><input type="checkbox" class="poicheck" data-cat="amenity" data-sub="charging_station"> Punto de carga</label>
    <label><input type="checkbox" class="poicheck" data-cat="amenity" data-sub="bicycle_repair_station"> Reparaci√≥n bici</label>
   <div class="separadorBloque"></div>
    <!-- ‚õ∫ Descanso y refugio -->
        <label><input type="checkbox" class="poicheck" data-cat="amenity" data-sub="drinking_water"> Agua potable</label>
         <label><input type="checkbox" class="poicheck" data-cat="tourism" data-sub="camp_site"> Camping</label>
    <label><input type="checkbox" class="poicheck" data-cat="tourism" data-sub="caravan_site"> Caravanas</label>
    <label><input type="checkbox" class="poicheck" data-cat="amenity" data-sub="shelter"> Refugio sencillo</label>
    <label><input type="checkbox" class="poicheck" data-cat="tourism" data-sub="alpine_hut"> Refugio de monta√±a</label>
    <label><input type="checkbox" class="poicheck" data-cat="tourism" data-sub="wilderness_hut"> Refugio b√°sico</label>
    <label><input type="checkbox" class="poicheck" data-cat="tourism" data-sub="picnic_site"> Zona picnic</label>
    <label><input type="checkbox" class="poicheck" data-cat="amenity" data-sub="firepit"> Zona fuego(barbacoa)</label>
    <div class="separadorBloque"></div>
    <!-- üèûÔ∏è Entorno natural -->
    <label><input type="checkbox" class="poicheck" data-cat="natural" data-sub="tree"> √Årbol destacado</label>
     <label><input type="checkbox" class="poicheck" data-cat="waterway" data-sub="waterfall"> Cascada</label>
     <label><input type="checkbox" class="poicheck" data-cat="natural" data-sub="saddle"> Collado</label>
    <label><input type="checkbox" class="poicheck" data-cat="natural" data-sub="cave_entrance"> Cueva</label>
    <label><input type="checkbox" class="poicheck" data-cat="natural" data-sub="rock"> Formaci√≥n rocosa</label>
    <label><input type="checkbox" class="poicheck" data-cat="natural" data-sub="spring"> Manantial</label>
   <label><input type="checkbox" class="poicheck" data-cat="tourism" data-sub="viewpoint"> Mirador</label>
     <label><input type="checkbox" class="poicheck" data-cat="natural" data-sub="mountain_pass"> Paso monta√±oso</label>
    <label><input type="checkbox" class="poicheck" data-cat="natural" data-sub="peak"> Pico</label>
    <label><input type="checkbox" class="poicheck" data-cat="natural" data-sub="volcano"> Volc√°n</label>
   <div class="separadorBloque"></div> 
    <!-- üè• Emergencia y salud -->
         <label><input type="checkbox" class="poicheck" data-cat="amenity" data-sub="doctors"> Centro m√©dico / doctor</label>
           <label><input type="checkbox" class="poicheck" data-cat="amenity" data-sub="pharmacy"> Farmacia</label>
    <label><input type="checkbox" class="poicheck" data-cat="amenity" data-sub="hospital"> Hospital</label>
    <label><input type="checkbox" class="poicheck" data-cat="emergency" data-sub="emergency_phone"> Tel√©fono de emergencia</label>
    <div class="separadorBloque"></div>
    <!-- üè∞ Elementos hist√≥ricos , hechos por el hombre -->
    <label><input type="checkbox" class="poicheck" data-cat="historic" data-sub="castle"> Castillo</label>
       <label><input type="checkbox" class="poicheck" data-cat="man_made" data-sub="watermill"> Molino de Agua</label>
      <label><input type="checkbox" class="poicheck" data-cat="man_made" data-sub="windmill"> Molino de Viento</label>
      <label><input type="checkbox" class="poicheck" data-cat="historic" data-sub="ruins"> Ruinas</label>
    <label><input type="checkbox" class="poicheck" data-cat="man_made" data-sub="survey_point"> V√©rtice </label>
  </div>
</div>
<div id="panelcomodidades" class="subpanel hidden">
  <button class="btnVolverPanel soloIcono" onclick="volverCategorias()">
    <img src="icons/ui/fi-sr-arrow-small-left.svg" alt="Volver">
  </button>
 <h2>
  <img src="icons/ui/fi-sr-faucet.svg" alt="Comodidades" class="icono-panel">
  Comodidades
</h2>
    <!-- Bot√≥n buscar POIs con icono SVG -->
  <button class="btnBuscarPanel" id="panelcomodidades">
    <img src="icons/ui/fi-sr-search.svg" alt="Buscar POIs">
    <span>Buscar POIs</span>
  </button>
  <div class="contenedorFiltros">
  <label>
    <input type="checkbox" class="poicheck" data-cat="amenity" data-sub="drinking_water">
    Agua potable
  </label>
  <label>
    <input type="checkbox" class="poicheck" data-cat="amenity" data-sub="toilets">
    Aseos p√∫blicos
  </label>
  <label>
    <input type="checkbox" class="poicheck" data-cat="amenity" data-sub="bench">
    Banco
  </label>
  <label>
    <input type="checkbox" class="poicheck" data-cat="amenity" data-sub="public_bath">
    Ba√±o p√∫blico / termal
  </label>
  <label>
    <input type="checkbox" class="poicheck" data-cat="amenity" data-sub="fountain">
    Fuente
  </label>
  <label>
    <input type="checkbox" class="poicheck" data-cat="amenity" data-sub="recycling">
    Punto reciclaje
  </label>
  <label>
    <input type="checkbox" class="poicheck" data-cat="amenity" data-sub="shelter">
    Refugio c√≥modo
  </label>
  <label>
    <input type="checkbox" class="poicheck" data-cat="amenity" data-sub="lounger">
    Tumbona
  </label>
</div>
</div>

<div id="panelemergencias" class="subpanel hidden">
  <button class="btnVolverPanel soloIcono" onclick="volverCategorias()">
    <img src="icons/ui/fi-sr-arrow-small-left.svg" alt="Volver">
  </button>
  <h2>
  <img src="icons/ui/fi-sr-hospital.svg" alt="Emergencias" class="icono-panel">
  Emergencias
</h2>
     <!-- Bot√≥n buscar POIs con icono SVG -->
  <button class="btnBuscarPanel" id="panelemergencias">
    <img src="icons/ui/fi-sr-search.svg" alt="Buscar POIs">
    <span>Buscar POIs</span>
  </button>
 <div class="contenedorFiltros">
  <label>
    <input type="checkbox" class="poicheck" data-cat="amenity" data-sub="fire_station">
    Bomberos
  </label>
  <label>
    <input type="checkbox" class="poicheck" data-cat="amenity" data-sub="doctors">
    Centro m√©dico / doctor
  </label>
  <label>
    <input type="checkbox" class="poicheck" data-cat="emergency" data-sub="defibrillator">
    Desfibrilador
  </label>
  <label>
    <input type="checkbox" class="poicheck" data-cat="amenity" data-sub="pharmacy">
    Farmacia
  </label>
  <label>
    <input type="checkbox" class="poicheck" data-cat="amenity" data-sub="hospital">
    Hospital
  </label>
  <label>
    <input type="checkbox" class="poicheck" data-cat="amenity" data-sub="police">
    Polic√≠a
  </label>
  <label>
   <input type="checkbox" class="poicheck" data-cat="emergency" data-sub="emergency_access_point">
    Punto de acceso m√©dico
  </label>
  <label>
    <input type="checkbox" class="poicheck" data-cat="emergency" data-sub="emergency_phone">
    Tel√©fono de emergencia
  </label>
</div>
</div>

<div id="panelnaturaleza" class="subpanel hidden">
  <button class="btnVolverPanel soloIcono" onclick="volverCategorias()">
    <img src="icons/ui/fi-sr-arrow-small-left.svg" alt="Volver">
  </button>
 <h2>
  <img src="icons/ui/fi-sr-mountain.svg" alt="Naturaleza" class="icono-panel">
  Naturaleza
</h2>
   <!-- Bot√≥n buscar POIs con icono SVG -->
  <button class="btnBuscarPanel" id="panelnaturaleza">
    <img src="icons/ui/fi-sr-search.svg" alt="Buscar POIs">
    <span>Buscar POIs</span>
  </button>
  <div class="contenedorFiltros">
  <label>
    <input type="checkbox" class="poicheck" data-cat="natural" data-sub="cliff">
    Acantilado
  </label>
  <label>
    <input type="checkbox" class="poicheck" data-cat="boundary" data-sub="protected_area">
    √Årea protegida
  </label>
  <label>
    <input type="checkbox" class="poicheck" data-cat="natural" data-sub="tree">
    √Årbol destacado
  </label>
  <label>
    <input type="checkbox" class="poicheck" data-cat="waterway" data-sub="waterfall">
    Cascada
  </label>
  <label>
    <input type="checkbox" class="poicheck" data-cat="natural" data-sub="saddle">
    Collado
  </label>
  <label>
    <input type="checkbox" class="poicheck" data-cat="natural" data-sub="cave_entrance">
    Cueva
  </label>
  <label>
    <input type="checkbox" class="poicheck" data-cat="natural" data-sub="rock">
    Formaci√≥n rocosa
  </label>
   <label>
    <input type="checkbox" class="poicheck" data-cat="leisure" data-sub="botanical_garden">
    Jard√≠n bot√°nico
  </label>
   <label>
    <input type="checkbox" class="poicheck" data-cat="natural" data-sub="spring">
    Manantial
  </label>
  <label>
    <input type="checkbox" class="poicheck" data-cat="tourism" data-sub="viewpoint">
    Mirador
  </label>
  <label>
    <input type="checkbox" class="poicheck" data-cat="leisure" data-sub="park">
    Parque
  </label>
  <label>
    <input type="checkbox" class="poicheck" data-cat="natural" data-sub="mountain_pass">
    Paso monta√±oso
  </label>
  <label>
    <input type="checkbox" class="poicheck" data-cat="natural" data-sub="beach">
    Playa
  </label>
  <label>
    <input type="checkbox" class="poicheck" data-cat="natural" data-sub="peak">
    Pico
  </label>
  <label>
    <input type="checkbox" class="poicheck" data-cat="natural" data-sub="volcano">
    Volc√°n
  </label>
</div>
</div>

<div id="panelocio_turismo" class="subpanel hidden">
  <button class="btnVolverPanel soloIcono" onclick="volverCategorias()">
    <img src="icons/ui/fi-sr-arrow-small-left.svg" alt="Volver">
  </button>
  <h2>
    <img src="icons/ui/fi-sr-castle.svg" alt="Ocio y turismo" class="icono-panel">
    Ocio y turismo
  </h2>
  <button class="btnBuscarPanel" id="panelocio_turismo">
    <img src="icons/ui/fi-sr-search.svg" alt="Buscar POIs">
    <span>Buscar POIs</span>
  </button>

  <div class="contenedorFiltros">
       <label><input type="checkbox" class="poicheck" data-cat="historic" data-sub="wayside_shrine"> Altar</label>
    <label><input type="checkbox" class="poicheck" data-cat="tourism" data-sub="attraction"> Atracci√≥n tur√≠stica</label>
     <label><input type="checkbox" class="poicheck" data-cat="tourism" data-sub="artwork"> Arte p√∫blico</label>
    <label><input type="checkbox" class="poicheck" data-cat="amenity" data-sub="bar"> Bar</label>
    <label><input type="checkbox" class="poicheck" data-cat="amenity" data-sub="biergarten"> Biergarten</label>
    <label><input type="checkbox" class="poicheck" data-cat="amenity" data-sub="library"> Biblioteca</label>
    <label><input type="checkbox" class="poicheck" data-cat="historic" data-sub="castle"> Castillo</label>
    <label><input type="checkbox" class="poicheck" data-cat="amenity" data-sub="cafe"> Cafeter√≠a</label>
    <label><input type="checkbox" class="poicheck" data-cat="amenity" data-sub="cinema"> Cine</label>
       <label><input type="checkbox" class="poicheck" data-cat="amenity" data-sub="fast_food"> Comida r√°pida</label>
        <label><input type="checkbox" class="poicheck" data-cat="historic" data-sub="wayside_cross"> Cruz hist√≥rica</label>
     <label><input type="checkbox" class="poicheck" data-cat="tourism" data-sub="sculpture"> Escultura</label>
    <label><input type="checkbox" class="poicheck" data-cat="tourism" data-sub="gallery"> Galer√≠a de arte</label>
    <label><input type="checkbox" class="poicheck" data-cat="amenity" data-sub="ice_cream"> Helader√≠a</label>
     <label><input type="checkbox" class="poicheck" data-cat="amenity" data-sub="place_of_worship"> Iglesia </label>
    <label><input type="checkbox" class="poicheck" data-cat="historic" data-sub="memorial"> Memorial</label>
    <label><input type="checkbox" class="poicheck" data-cat="historic" data-sub="monument"> Monumento</label>
       <label><input type="checkbox" class="poicheck" data-cat="man_made" data-sub="watermill"> Molino de Agua</label>
      <label><input type="checkbox" class="poicheck" data-cat="man_made" data-sub="windmill"> Molino de Viento</label>
    <label><input type="checkbox" class="poicheck" data-cat="tourism" data-sub="museum"> Museo</label>
    <label><input type="checkbox" class="poicheck" data-cat="amenity" data-sub="pub"> Pub / cervecer√≠a</label>
    <label><input type="checkbox" class="poicheck" data-cat="amenity" data-sub="public_bookcase"> Estanter√≠a p√∫blica</label>
    <label><input type="checkbox" class="poicheck" data-cat="amenity" data-sub="restaurant"> Restaurante</label>
   <label><input type="checkbox" class="poicheck" data-cat="historic" data-sub="ruins"> Ruinas</label> 
    <label><input type="checkbox" class="poicheck" data-cat="historic" data-sub="archaeological_site"> Sitio arqueol√≥gico</label>
    <label><input type="checkbox" class="poicheck" data-cat="amenity" data-sub="theatre"> Teatro</label>
    <label><input type="checkbox" class="poicheck" data-cat="man_made" data-sub="survey_point"> V√©rtice </label>
    <label><input type="checkbox" class="poicheck" data-cat="tourism" data-sub="zoo"> Zool√≥gico</label>
  </div>
</div>


<div id="paneltransporte" class="subpanel hidden">
  <button class="btnVolverPanel soloIcono" onclick="volverCategorias()">
    <img src="icons/ui/fi-sr-arrow-small-left.svg" alt="Volver">
  </button>
  <h2>
    <img src="icons/ui/fi-sr-plane-alt.svg" alt="Transporte" class="icono-panel">
    Transporte
  </h2>
  <button class="btnBuscarPanel" id="btnBuscarTransporte">üîç Buscar POIs</button>

  <div class="contenedorFiltros">
    <label><input type="checkbox" class="poicheck" data-cat="aeroway" data-sub="aerodrome"> Aeropuerto</label>
    <label><input type="checkbox" class="poicheck" data-cat="railway" data-sub="crossing"> Cruce ferroviario</label>
    <label><input type="checkbox" class="poicheck" data-cat="amenity" data-sub="parking_entrance"> Entrada a parking</label>
    <label><input type="checkbox" class="poicheck" data-cat="railway" data-sub="subway_entrance"> Entrada a metro</label>
    <label><input type="checkbox" class="poicheck" data-cat="railway" data-sub="station"> Estaci√≥n ferroviaria</label>
    <label><input type="checkbox" class="poicheck" data-cat="amenity" data-sub="bus_station"> Estaci√≥n de bus</label>
    <label><input type="checkbox" class="poicheck" data-cat="aerialway" data-sub="station"> Estaci√≥n de telef√©rico</label>
    <label><input type="checkbox" class="poicheck" data-cat="amenity" data-sub="ferry_terminal"> Terminal ferry</label>
    <label><input type="checkbox" class="poicheck" data-cat="railway" data-sub="level_crossing"> Paso a nivel</label>
    <label><input type="checkbox" class="poicheck" data-cat="highway" data-sub="bus_stop"> Parada de bus</label>
    <label><input type="checkbox" class="poicheck" data-cat="amenity" data-sub="parking"> Parking</label>
    <label><input type="checkbox" class="poicheck" data-cat="aeroway" data-sub="helipad"> Helipuerto</label>
  </div>
</div>
<div id="panelservicios" class="subpanel hidden">
  <button class="btnVolverPanel soloIcono" onclick="volverCategorias()">
    <img src="icons/ui/fi-sr-arrow-small-left.svg" alt="Volver">
  </button>
  <h2>
    <img src="icons/ui/fi-sr-tools.svg" alt="Servicios" class="icono-panel">
    Servicios
  </h2>
  <button class="btnBuscarPanel" id="panelservicios">
    <img src="icons/ui/fi-sr-search.svg" alt="Buscar POIs">
    <span>Buscar POIs</span>
  </button>
  <div class="contenedorFiltros">

    <!-- üõí Comercio -->
    <label><input type="checkbox" class="poicheck" data-cat="shop" data-sub="travel_agency"> Agencia de viajes</label>
    <label><input type="checkbox" class="poicheck" data-cat="amenity" data-sub="bank"> Banco</label>
    <label><input type="checkbox" class="poicheck" data-cat="shop" data-sub="bicycle"> Bicicletas</label>
    <label><input type="checkbox" class="poicheck" data-cat="shop" data-sub="doityourself"> Bricolaje / Ferreter√≠a</label>
    <label><input type="checkbox" class="poicheck" data-cat="amenity" data-sub="post_box"> Buz√≥n</label>
    <label><input type="checkbox" class="poicheck" data-cat="shop" data-sub="butcher"> Carnicer√≠a</label>
    <label><input type="checkbox" class="poicheck" data-cat="amenity" data-sub="atm"> Cajero autom√°tico</label>
    <label><input type="checkbox" class="poicheck" data-cat="amenity" data-sub="fuel"> Gasolinera</label>
    <label><input type="checkbox" class="poicheck" data-cat="amenity" data-sub="laundry"> Lavander√≠a</label>
    <label><input type="checkbox" class="poicheck" data-cat="shop" data-sub="books"> Librer√≠a</label>
    <label><input type="checkbox" class="poicheck" data-cat="amenity" data-sub="post_office"> Oficina de correos</label>
    <label><input type="checkbox" class="poicheck" data-cat="shop" data-sub="bakery"> Panader√≠a</label>
    <label><input type="checkbox" class="poicheck" data-cat="shop" data-sub="chemist"> Perfumer√≠a / Botica</label>
    <label><input type="checkbox" class="poicheck" data-cat="shop" data-sub="organic"> Tienda ecol√≥gica</label>
    <label><input type="checkbox" class="poicheck" data-cat="shop" data-sub="convenience"> Tienda de conveniencia</label>
    <label><input type="checkbox" class="poicheck" data-cat="shop" data-sub="sports"> Tienda deportiva</label>
    <label><input type="checkbox" class="poicheck" data-cat="shop" data-sub="supermarket"> Supermercado</label>

  </div>
</div>

  </div> <!-- #sidebar -->
      
     <div id="infoCabeceraMapa">
  <span id="altitudMapa">Altitud: -- m</span> |
  <span id="zoomMapa">Zoom --</span> |
  <span id="coordenadasMapa">--</span>
</div>

<div id="estadoAltitud" style="font-size: 13px; color: #ccc; margin-top: 8px;">
  Estado de altitud: esperando...
</div>
  <!-- üó∫Ô∏è Mapa principal -->
  <div id="map"></div>

 <div id="panelPoi" class="bottom-sheet hidden">
  <!-- üìé Grip superior -->
  <div class="grip"></div>

  <!-- üîò Bot√≥n cerrar -->
  <button class="btn-cerrar" id="cerrarPanelPoi" title="Cerrar panel">
    <img src="icons/ui/fi-sr-cross-small.svg" alt="Cerrar" />
  </button>

  <!-- üîº Bot√≥n expandir -->
  <button class="expandir-btn" id="btnExpandirPanel" title="Expandir panel">
    <img src="icons/ui/fi-sr-expand.svg" alt="Expandir" />
  </button>

  <!-- üìÑ Contenido del POI -->
  <div class="contenido-poi">
    <h2 id="poiNombre">POI</h2>
    <div id="poiDatos"></div>
    
    <!-- üéØ Botones de funciones -->
<div class="acciones-poi">
  <button class="accion-btn" id="btnCompartir" title="Compartir">
    <img src="icons/ui/fi-sr-share.svg" alt="Compartir" />
  </button>
  <button class="accion-btn" id="btnExportar" title="Exportar">
    <img src="icons/ui/fi-sr-download.svg" alt="Exportar" />
  </button>
  <button class="accion-btn" id="btnContribuirPOI" title="Contribuir">
    <img src="icons/ui/fi-sr-attribution-pencil.svg" alt="Contribuir" />
  </button>
  <button class="accion-btn" id="btnVisualizarPOI" title="Ver ubicaci√≥n">
    <img src="icons/ui/fi-sr-overview.svg" alt="Visualizar POI" />
  </button>
</div>

 <!-- üìë Men√∫ compartir -->
<div class="menu-emergente" id="menuCompartir">
  <button onclick="compartirTextoPOI()">
    <img src="icons/ui/fi-sr-blog-text.svg" alt="Texto POI" />
    <span>Compartir como texto</span>
  </button>
  <button onclick="compartirPosicionPOI()">
    <img src="icons/ui/fi-sr-map-marker.svg" alt="Ubicaci√≥n POI" />
    <span>Compartir posici√≥n en otra app</span>
  </button>
</div>

<!-- üì¶ Men√∫ exportar -->
<div class="menu-emergente" id="menuExportar">
  <button onclick="exportarPOIIndividual(window.tagsPOI)">
    <img src="icons/ui/fi-sr-clip.svg" alt="Icono exportar POI" />
    <span>Exportar este POI como KML</span>
  </button>
</div>

<!-- ü§ù Men√∫ contribuir -->
<div class="menu-emergente" id="menuContribuir">
    <button class="cerrarMenuContribuir" aria-label="Cerrar panel">
  <img src="icons/ui/fi-sr-cross-small.svg" alt="Cerrar" />
</button>
  <div class="guia-osm">
    <p>üí° ¬øQu√© puedo aportar aqu√≠?</p>
    <ul>
      <li>üìç El lugar no tiene nombre o categor√≠a</li>
      <li>‚ö†Ô∏è Est√° cerrado, abandonado o ya no existe</li>
      <li>üö´ Acceso bloqueado o error en ubicaci√≥n</li>
      <li>‚úèÔ∏è Faltan detalles: horario, servicios, tipo</li>
      <li>üì∏ No aparece en el mapa, pero s√≠ en la realidad</li>
    </ul>
    <p>
      Tus sugerencias se publican como <strong>nota p√∫blica</strong> en OSM.<br />
      No necesitas cuenta, pero puedes iniciar sesi√≥n si lo deseas.<br />
      Los editores revisan estas notas para mejorar el mapa üôå
    </p>
  </div>

  <button onclick="abrirEditorOSM()">
    <img src="icons/ui/fi-sr-code-editing.svg" alt="Editor OSM" />
    <span>Editar directamente en OpenStreetMap</span>
  </button>

  <button onclick="a√±adirNotaOSM()">
    <img src="icons/ui/fi-sr-blog-pencil.svg" alt="A√±adir nota OSM" />
    <span>A√±adir sugerencia como nota p√∫blica</span>
  </button>
</div>
<!-- üó∫Ô∏è Men√∫ ver ubicaci√≥n -->
<div class="menu-emergente" id="menuVer">
  <button onclick="abrirVisorWebDesdePOI('streetview')">
    <img src="icons/ui/fi-sr-street-view.svg" alt="Street View" />
    <span>Ver en Street View</span>
  </button>

  <button onclick="abrirVisorWebDesdePOI('mapillary')">
    <img src="icons/ui/fi-sr-camera-viewfinder.svg" alt="Mapillary" />
    <span>Ver en Mapillary</span>
  </button>

  <button onclick="abrirVisorWebDesdePOI('peakfinder')">
    <img src="icons/ui/fi-sr-mountains.svg" alt="PeakFinder" />
    <span>Ver en PeakFinder</span>
  </button>
</div>

<div id="visorWeb" class="visor-full hidden">
  <div class="visor-barra">
    <span id="visorTitulo">Visor</span>
    <button onclick="cerrarVisorWeb()">‚ùå</button>
  </div>
  <iframe id="iframeWeb" src="" loading="lazy" allowfullscreen></iframe>
</div>

  
  <!-- ‚öôÔ∏è Script principal -->
  <script src="script.js" defer></script>
<!--  captura de pantalla -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('./sw.js')
      .then(() => console.log('Service Worker registrado ‚úÖ'))
      .catch(err => console.error('Error al registrar SW', err));
  }
  </script>
 
</body>
</html>
